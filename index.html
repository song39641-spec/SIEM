<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIEM 資產與威脅戰情室</title>
    
    <!-- CSS & Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.6/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              slate: { 850: '#1e293b' }
            },
            animation: {
                'fade-in-up': 'fadeInUp 0.3s ease-out forwards'
            },
            keyframes: {
                fadeInUp: {
                    '0%': { opacity: '0', transform: 'translateY(10px)' },
                    '100%': { opacity: '1', transform: 'translateY(0)' },
                }
            }
          }
        }
      }
    </script>

    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
          "lucide-react": "https://esm.sh/lucide-react@0.292.0"
        }
      }
    </script>
</head>
<body class="bg-gray-100 text-slate-800 h-screen overflow-hidden">
    
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useRef, useEffect, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import * as LucideIcons from 'lucide-react';
        
        // Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Mermaid Initialization ---
        mermaid.initialize({ 
            startOnLoad: true, 
            theme: 'base',
            themeVariables: {
                primaryColor: '#e0e7ff',
                lineColor: '#4f46e5',
                secondaryColor: '#f1f5f9',
                tertiaryColor: '#fff'
            }
        });

        // --- Helpers ---
        const SafeText = ({ content }) => {
            if (content === null || content === undefined) return null;
            try {
                if (typeof content === 'string' || typeof content === 'number') return <>{content}</>;
                if (typeof content === 'boolean') return <>{String(content)}</>;
                if (Array.isArray(content)) {
                    return <>{content.map(c => (typeof c === 'object' ? JSON.stringify(c) : String(c))).join(', ')}</>;
                }
                if (typeof content === 'object') {
                    if (content.seconds) return <>{new Date(content.seconds * 1000).toLocaleString()}</>;
                    return <>{JSON.stringify(content)}</>;
                }
                return <>{String(content)}</>;
            } catch (e) { return <>Data Error</>; }
        };

        const renderMarkdown = (text) => {
            if (!text || typeof text !== 'string') return null;
            const lines = text.split('\n');
            const elements = [];
            let tableRows = [];
            let inCodeBlock = false;
            
            const flushTable = (idx) => {
                if (tableRows.length === 0) return null;
                const dataRows = tableRows.filter(row => !/^[|\s-:]+$/.test(row) && row.includes('|'));
                if (dataRows.length === 0) return null;
                const parseRow = (rowStr) => rowStr.split('|').filter(c => c.trim() !== '').map(c => c.trim());
                const headers = parseRow(dataRows[0]);
                const bodyRows = dataRows.slice(1);
                return (
                    <div key={`table-${idx}`} className="overflow-x-auto my-4 border border-gray-200 rounded-lg shadow-sm">
                        <table className="min-w-full divide-y divide-gray-200 text-sm">
                            <thead className="bg-slate-50">
                                <tr>{headers.map((h, i) => <th key={i} className="px-4 py-2 text-left text-xs font-bold text-slate-700 border-r last:border-r-0">{h}</th>)}</tr>
                            </thead>
                            <tbody className="bg-white divide-y">
                                {bodyRows.map((r, i) => <tr key={i} className="hover:bg-slate-50">{parseRow(r).map((c, j) => <td key={j} className="px-4 py-2 border-r last:border-r-0">{c}</td>)}</tr>)}
                            </tbody>
                        </table>
                    </div>
                );
            };

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i];
                if (line.trim().startsWith('```')) {
                    inCodeBlock = !inCodeBlock;
                    if (!inCodeBlock) { 
                        elements.push(<pre key={`code-${i}`} className="bg-slate-800 text-green-400 p-4 rounded-lg text-xs overflow-x-auto font-mono my-3 shadow-inner">{tableRows.join('\n')}</pre>); 
                        tableRows = []; 
                    }
                    continue;
                }
                if (inCodeBlock) { tableRows.push(line); continue; }
                if (line.trim().startsWith('|')) { tableRows.push(line.trim()); } 
                else {
                    if (tableRows.length > 0) { elements.push(flushTable(i)); tableRows = []; }
                    if (line.startsWith('###')) elements.push(<h3 key={i} className="font-bold text-slate-800 mt-4 border-l-4 border-indigo-500 pl-3 text-lg">{line.replace(/#/g, '')}</h3>);
                    else if (line.startsWith('- ') || line.startsWith('* ')) elements.push(<li key={i} className="ml-4 text-sm text-slate-600 mb-1 list-disc">{line.substring(2)}</li>);
                    else if (line.trim().length > 0) elements.push(<p key={i} className="text-sm text-slate-600 mb-2 leading-relaxed">{line}</p>);
                }
            }
            if (tableRows.length > 0 && !inCodeBlock) elements.push(flushTable('end'));
            return elements;
        };

        const AttackGraph = ({ mermaidCode }) => {
            const ref = useRef(null);
            useEffect(() => {
                if (mermaidCode && ref.current) {
                    try {
                        mermaid.render(`graph-${Math.random().toString(36).substr(2, 9)}`, mermaidCode).then(({ svg }) => {
                            ref.current.innerHTML = svg;
                        });
                    } catch (err) { ref.current.innerHTML = `<div class="text-red-500 text-xs">圖表生成失敗</div>`; }
                }
            }, [mermaidCode]);
            return <div ref={ref} className="w-full flex justify-center py-4 bg-white rounded-lg border border-slate-100 overflow-x-auto"></div>;
        };

        const ScenarioCard = ({ scenario, onAction }) => {
            const severityColors = {
                Critical: 'bg-rose-900 text-white border-rose-900',
                High: 'bg-red-50 text-red-600 border-red-200',
                Medium: 'bg-yellow-50 text-yellow-600 border-yellow-200',
                Low: 'bg-blue-50 text-blue-600 border-blue-200'
            };
            return (
                <div className="border border-slate-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow mb-3 text-sm group relative">
                    <div className="flex justify-between items-start mb-2">
                        <div className="w-full">
                            <div className="flex items-center gap-2 flex-wrap mb-1">
                                <span className={`text-xs px-2 py-0.5 rounded border font-bold ${severityColors[scenario.severity] || 'bg-slate-100'}`}>{scenario.severity}</span>
                                <span className="font-bold text-slate-800 text-base">{scenario.title}</span>
                            </div>
                            <div className="flex justify-between items-center text-xs text-slate-400 mt-1">
                                <span>{scenario.source_date || '即時分析'}</span>
                                <span className="bg-slate-100 px-2 py-0.5 rounded text-slate-600 font-medium">{scenario.category}</span>
                            </div>
                        </div>
                    </div>
                    <div className="bg-slate-50 p-3 rounded-lg text-xs text-slate-700 mt-2 border border-slate-100">
                        <div className="mb-2"><strong>關聯邏輯:</strong> {scenario.correlation_logic}</div>
                        <div className="flex flex-wrap gap-2 mt-4 opacity-80 group-hover:opacity-100">
                            <button onClick={() => onAction('visualize', scenario)} className="flex items-center gap-1 text-white bg-indigo-600 px-2 py-1 rounded shadow-sm"><LucideIcons.Eye size={12}/> 視覺化</button>
                            <button onClick={() => onAction('playbook', scenario.title)} className="flex items-center gap-1 text-rose-600 border border-rose-200 px-2 py-1 rounded"><LucideIcons.BookOpen size={12}/> IR 劇本</button>
                            <button onClick={() => onAction('rule', scenario.title)} className="flex items-center gap-1 text-blue-600 border border-blue-200 px-2 py-1 rounded"><LucideIcons.Code2 size={12}/> 規則</button>
                            <button onClick={() => onAction('logs', scenario.title)} className="flex items-center gap-1 text-slate-600 border border-slate-200 px-2 py-1 rounded"><LucideIcons.FileJson size={12}/> Logs</button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App ---
        const WarRoom = () => {
            const { 
                Briefcase, Server, ShieldCheck, Target, Activity, Loader2, BrainCircuit, 
                Cloud, CloudOff, Check, Plus, Trash, History, AlertOctagon, AlertTriangle, 
                FileText, Wand2, LayoutDashboard, ListChecks, BarChart3, Wrench, Download, 
                LayoutGrid, ScrollText, X, Send, MessageSquare, Terminal, Microscope, Bug, Footprints, Waypoints, Eye, Save
            } = LucideIcons;

            const apiKey = ""; // API Key 運行時自動提供
            const firebaseConfig = JSON.parse(__firebase_config);
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-siem-app';

            // --- States ---
            const [user, setUser] = useState(null);
            const [syncStatus, setSyncStatus] = useState('connecting');
            const [activeTab, setActiveTab] = useState('assets');
            const [assetList, setAssetList] = useState([]);
            const [threatData, setThreatData] = useState(null);
            const [threatLoading, setThreatLoading] = useState(false);
            const [threatHistory, setThreatHistory] = useState([]);
            const [threatViewTab, setThreatViewTab] = useState('current');
            
            // AI Chat States
            const [isChatOpen, setIsChatOpen] = useState(false);
            const [chatHistory, setChatHistory] = useState([{ role: 'bot', text: '您好！我是您的 SOC 智能助手。我可以協助您解讀威脅情報或生成 IR 劇本。' }]);
            const [chatInput, setChatInput] = useState("");
            const [chatLoading, setChatLoading] = useState(false);

            // Modals
            const [selectedScenarioForVis, setSelectedScenarioForVis] = useState(null);
            const [logParserOpen, setLogParserOpen] = useState(false);

            // --- Auth & Data ---
            useEffect(() => {
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                };
                initAuth();
                return onAuthStateChanged(auth, setUser);
            }, []);

            useEffect(() => {
                if (!user) return;
                setSyncStatus('connecting');

                // 修正：依照規則使用正確的路徑
                const assetDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'assets');
                const historyDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'threatHistory');

                const unsubAssets = onSnapshot(assetDocRef, (snap) => {
                    if (snap.exists()) setAssetList(snap.data().items || []);
                }, (err) => setSyncStatus('error'));

                const unsubHistory = onSnapshot(historyDocRef, (snap) => {
                    if (snap.exists()) {
                        const items = snap.data().items || [];
                        setThreatHistory(items);
                        if (items.length > 0 && !threatData) setThreatData(items[0]);
                    }
                });

                setSyncStatus('synced');
                return () => { unsubAssets(); unsubHistory(); };
            }, [user]);

            const saveToDB = async (collectionName, data) => {
                if (!user) return;
                try {
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', collectionName);
                    await setDoc(docRef, { items: data });
                } catch (e) { console.error("Save Error", e); }
            };

            // --- Gemini API ---
            const fetchAI = async (prompt) => {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "無法獲取回應";
            };

            const handleAnalyze = async () => {
                if (assetList.length === 0) return;
                setThreatLoading(true);
                setThreatViewTab('current');
                const assetString = assetList.map(a => `- ${a.name} (${a.category})`).join('\n');
                const prompt = `你是一位資深 SIEM 架構師。根據以下資產：\n${assetString}\n產出 JSON 格式的 5 個威脅情境，包含 title, category, severity, correlation_logic, mermaid_code (graph LR), data_sources (Array: {device, event}), admin_log_guide (Array: {system, log_items, config_advice})。繁體中文。`;
                
                try {
                    const res = await fetchAI(prompt);
                    const json = JSON.parse(res.match(/\{[\s\S]*\}/)[0]);
                    const final = { ...json, timestamp: new Date().toLocaleString(), analysis_type: '綜合分析' };
                    setThreatData(final);
                    saveToDB('threatHistory', [final, ...threatHistory]);
                } catch (e) { console.error(e); } finally { setThreatLoading(false); }
            };

            const handleChatAction = async (type, title) => {
                setIsChatOpen(true);
                let prompt = "";
                if (type === 'playbook') prompt = `產生『${title}』的 IR 劇本，符合 NIST 流程。`;
                else if (type === 'rule') prompt = `為『${title}』撰寫 Splunk SPL 與 Sigma 偵測規則。`;
                else if (type === 'logs') prompt = `產生『${title}』的模擬 Log 樣本 (JSON)。`;
                
                setChatHistory(prev => [...prev, { role: 'user', text: prompt }]);
                setChatLoading(true);
                try {
                    const reply = await fetchAI(prompt);
                    setChatHistory(prev => [...prev, { role: 'bot', text: reply }]);
                } catch (e) { setChatHistory(prev => [...prev, { role: 'bot', text: "生成失敗" }]); } finally { setChatLoading(false); }
            };

            const handleAssetUpdate = (newAssets) => {
                setAssetList(newAssets);
                saveToDB('assets', newAssets);
            };

            return (
                <div className="h-full flex flex-col bg-slate-50 relative">
                    {/* Header */}
                    <header className="bg-slate-900 text-white p-4 flex justify-between items-center shadow-lg z-20">
                        <div className="flex items-center gap-3">
                            <div className="p-2 bg-indigo-600 rounded-lg"><Briefcase size={24}/></div>
                            <div>
                                <h1 className="text-xl font-bold">SIEM 威脅戰情室</h1>
                                <p className="text-slate-400 text-xs">Asset & Intelligence Dashboard</p>
                            </div>
                        </div>
                        <div className="flex items-center gap-4">
                             <button onClick={() => setLogParserOpen(true)} className="text-xs bg-slate-800 px-3 py-1.5 rounded-lg border border-slate-700 flex items-center gap-1"><Microscope size={14}/> Log 解析</button>
                             <div className="flex items-center gap-1 bg-green-400/10 text-green-400 px-2 py-1 rounded-full text-xs">
                                <Check size={12}/> 雲端同步中
                             </div>
                        </div>
                    </header>

                    {/* Navigation */}
                    <div className="bg-white border-b border-gray-200 px-6 flex gap-8 shadow-sm">
                        <button onClick={()=>setActiveTab('assets')} className={`py-4 text-sm font-bold flex items-center gap-2 border-b-2 transition-colors ${activeTab==='assets'?'border-indigo-600 text-indigo-600':'border-transparent text-gray-500'}`}><Server size={16}/> 威脅分析</button>
                        <button onClick={()=>setActiveTab('history')} className={`py-4 text-sm font-bold flex items-center gap-2 border-b-2 transition-colors ${activeTab==='history'?'border-indigo-600 text-indigo-600':'border-transparent text-gray-500'}`}><LayoutDashboard size={16}/> 歷史看板</button>
                    </div>

                    <main className="flex-1 overflow-hidden flex">
                        {activeTab === 'assets' && (
                            <div className="flex w-full h-full">
                                {/* Left: Assets */}
                                <div className="w-1/3 bg-gray-50 border-r p-6 overflow-y-auto">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="font-bold flex items-center gap-2 text-slate-700"><Server size={18}/> 資產管理</h3>
                                        <button onClick={() => handleAssetUpdate([...assetList, { id: Date.now(), name: "New System", category: "應用系統" }])} className="text-xs bg-white border px-2 py-1 rounded shadow-sm hover:bg-gray-50"><Plus size={12}/></button>
                                    </div>
                                    <div className="space-y-2 mb-6">
                                        {assetList.map(a => (
                                            <div key={a.id} className="bg-white p-3 rounded-xl border border-gray-200 shadow-sm flex items-center gap-3">
                                                <div className="flex-1">
                                                    <input className="font-bold text-sm block w-full bg-transparent outline-none" value={a.name} onChange={(e) => handleAssetUpdate(assetList.map(item => item.id === a.id ? {...item, name: e.target.value} : item))}/>
                                                    <span className="text-[10px] text-indigo-500 uppercase font-bold">{a.category}</span>
                                                </div>
                                                <button onClick={() => handleAssetUpdate(assetList.filter(item => item.id !== a.id))} className="text-gray-300 hover:text-red-500"><Trash size={14}/></button>
                                            </div>
                                        ))}
                                    </div>
                                    <button onClick={handleAnalyze} disabled={threatLoading} className="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-indigo-700 disabled:opacity-50 flex justify-center items-center gap-2">
                                        {threatLoading ? <Loader2 size={18} className="animate-spin"/> : <Activity size={18}/>} 開始 AI 威脅分析
                                    </button>
                                </div>
                                {/* Right: Analysis Result */}
                                <div className="w-2/3 bg-white p-6 overflow-y-auto">
                                    {!threatData && !threatLoading ? (
                                        <div className="h-full flex flex-col items-center justify-center text-gray-300">
                                            <BrainCircuit size={64} className="opacity-30 mb-4"/>
                                            <p>請於左側加入資產並啟動分析</p>
                                        </div>
                                    ) : threatLoading ? (
                                        <div className="h-full flex flex-col items-center justify-center text-indigo-500">
                                            <Loader2 size={48} className="animate-spin mb-4"/>
                                            <p className="animate-pulse">正在利用 Gemini 進行威脅建模...</p>
                                        </div>
                                    ) : (
                                        <div className="space-y-6">
                                            <div className="flex justify-between items-center">
                                                <h2 className="text-lg font-bold flex items-center gap-2"><ShieldCheck className="text-emerald-500"/> 分析報告 - {threatData.timestamp}</h2>
                                            </div>
                                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-200">
                                                <h4 className="font-bold text-xs uppercase text-slate-500 mb-3 flex items-center gap-1"><ScrollText size={14}/> Log 收集指引</h4>
                                                <div className="space-y-2">
                                                    {threatData.admin_log_guide?.map((g, i) => (
                                                        <div key={i} className="text-xs flex gap-2"><span className="font-bold whitespace-nowrap">{g.system}:</span> <span className="text-slate-600">{g.log_items}</span></div>
                                                    ))}
                                                </div>
                                            </div>
                                            <div className="space-y-3">
                                                {threatData.scenarios?.map((s, i) => (
                                                    <ScenarioCard key={i} scenario={s} onAction={(type, data) => type === 'visualize' ? setSelectedScenarioForVis(data) : handleChatAction(type, data)}/>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'history' && (
                            <div className="flex-1 p-8 overflow-y-auto">
                                <h2 className="text-2xl font-bold mb-6">威脅歷史記錄</h2>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {threatHistory.map((h, i) => (
                                        <div key={i} onClick={() => { setThreatData(h); setActiveTab('assets'); }} className="bg-white p-5 rounded-2xl border hover:border-indigo-400 cursor-pointer transition-all shadow-sm">
                                            <div className="flex justify-between mb-2">
                                                <span className="text-xs text-gray-400 font-mono">{h.timestamp}</span>
                                                <span className="bg-indigo-50 text-indigo-600 text-[10px] px-2 py-0.5 rounded font-bold uppercase">{h.analysis_type}</span>
                                            </div>
                                            <div className="font-bold text-slate-800">偵測到 {h.scenarios?.length} 個情境</div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Modals */}
                    {selectedScenarioForVis && (
                        <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-6">
                            <div className="bg-white rounded-2xl w-full max-w-5xl h-[85vh] flex flex-col shadow-2xl overflow-hidden">
                                <div className="p-4 bg-slate-900 text-white flex justify-between">
                                    <h3 className="font-bold flex items-center gap-2"><Eye/> 攻擊路徑視覺化</h3>
                                    <button onClick={() => setSelectedScenarioForVis(null)}><X/></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-6 bg-slate-50 flex flex-col">
                                    <AttackGraph mermaidCode={selectedScenarioForVis.mermaid_code}/>
                                    <div className="mt-6 grid grid-cols-2 gap-4">
                                        <div className="bg-white p-4 rounded-xl shadow-sm">
                                            <h4 className="font-bold text-sm mb-2 text-indigo-600">數據源映射</h4>
                                            {selectedScenarioForVis.data_sources?.map((ds, i) => (
                                                <div key={i} className="text-xs mb-1 border-b pb-1"><strong>{ds.device}:</strong> {ds.event}</div>
                                            ))}
                                        </div>
                                        <div className="bg-white p-4 rounded-xl shadow-sm text-sm">
                                            <h4 className="font-bold text-sm mb-2 text-rose-600">偵測邏輯說明</h4>
                                            {selectedScenarioForVis.correlation_logic}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Chat Copilot */}
                    {isChatOpen && (
                        <div className="fixed bottom-6 right-6 w-96 h-[550px] bg-white rounded-2xl shadow-2xl border flex flex-col z-50 animate-in slide-in-from-bottom-5">
                            <div className="p-4 bg-slate-900 text-white rounded-t-2xl flex justify-between items-center">
                                <h4 className="font-bold flex items-center gap-2"><MessageSquare size={18}/> SOC Assistant</h4>
                                <button onClick={() => setIsChatOpen(false)}><X size={18}/></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50">
                                {chatHistory.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`p-3 rounded-2xl text-xs max-w-[90%] shadow-sm ${m.role==='user'?'bg-indigo-600 text-white':'bg-white border'}`}>
                                            {m.role === 'bot' ? renderMarkdown(m.text) : m.text}
                                        </div>
                                    </div>
                                ))}
                                {chatLoading && <Loader2 className="animate-spin text-indigo-600 mx-auto" size={20}/>}
                            </div>
                            <form onSubmit={(e) => { e.preventDefault(); handleChatAction('custom', chatInput); setChatInput(""); }} className="p-3 border-t bg-white rounded-b-2xl flex gap-2">
                                <input className="flex-1 text-xs border rounded-lg p-2 outline-none" placeholder="問問 AI 緩解建議..." value={chatInput} onChange={e=>setChatInput(e.target.value)}/>
                                <button className="bg-indigo-600 text-white p-2 rounded-lg"><Send size={16}/></button>
                            </form>
                        </div>
                    )}
                    {!isChatOpen && (
                        <button onClick={()=>setIsChatOpen(true)} className="fixed bottom-6 right-6 bg-indigo-600 text-white p-4 rounded-full shadow-xl hover:scale-110 transition-transform"><MessageSquare/></button>
                    )}
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<WarRoom />);
    </script>
</body>
</html>